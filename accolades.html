<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Accolades – LWFFL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root{
      --bg-main:#020617;
      --card-bg:#020617;
      --accent:#38bdf8;
      --border-subtle:#1f2937;
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --text-soft:#6b7280;
      --positive:#22c55e;
      --negative:#ef4444;
      --warning:#f59e0b;
    }

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0%, #020617 35%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 16px;
    }

    .shell{ max-width: 1100px; margin: 0 auto; }

    .container{
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.18), transparent 55%),
        var(--card-bg);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 40px 80px rgba(0,0,0,0.8), 0 0 0 1px rgba(15,23,42,0.9);
      padding: 28px 24px 28px;
      backdrop-filter: blur(14px);
    }

    .header{ text-align:center; margin-bottom: 16px; }
    .header h1{
      font-size: 2rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-weight: 700;
      margin-bottom: 6px;
      color:#f9fafb;
    }
    .header p{
      color: var(--text-soft);
      font-size: 0.9rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .leaderboard-card{
      background: radial-gradient(circle at top, rgba(15,23,42,0.97), rgba(15,23,42,0.99));
      border-radius: 14px;
      border: 1px solid rgba(31,41,55,0.95);
      box-shadow: 0 20px 40px rgba(15,23,42,0.95), 0 0 0 1px rgba(15,23,42,0.95);
      padding: 18px 16px 16px;
    }

    .leaderboard-header{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      margin-bottom: 12px;
      gap: 12px;
      flex-wrap:wrap;
    }

    .leaderboard-title{
      font-size:1.1rem;
      font-weight:600;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#e5e7eb;
      margin-bottom: 6px;
    }
    .leaderboard-subtitle{
      font-size:0.8rem;
      color: var(--text-soft);
      letter-spacing:0.16em;
      text-transform:uppercase;
      line-height: 1.3;
    }

    .table-wrap{
      width:100%;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 10px;
    }

    .leaderboard-table{
      width:100%;
      border-collapse: collapse;
      font-size:0.9rem;
      min-width: 860px;
      border-radius:10px;
      overflow:hidden;
    }
    .leaderboard-table thead{ background: linear-gradient(90deg, #020617, #020617); }
    .leaderboard-table th{
      padding: 8px 10px;
      font-size:0.78rem;
      text-transform:uppercase;
      letter-spacing:0.18em;
      color:#9ca3af;
      border-bottom: 1px solid rgba(55,65,81,0.9);
      white-space:nowrap;
      cursor:pointer;
      user-select:none;
      text-align:left;
    }

    .leaderboard-table tbody tr{ transition: background 0.15s ease, transform 0.08s ease; }
    .leaderboard-table tbody tr:nth-child(odd){ background:#020617; }
    .leaderboard-table tbody tr:nth-child(even){ background:#020617; }
    .leaderboard-table tbody tr:hover{ background: rgba(15,23,42,0.98); transform: translateY(-1px); }

    .leaderboard-table td{
      padding: 9px 10px;
      border-bottom: 1px solid rgba(31,41,55,0.96);
      color: var(--text-main);
      text-align:left;
      white-space:nowrap;
      font-variant-numeric: tabular-nums;
    }
    .leaderboard-table tbody tr:last-child td{ border-bottom:none; }

    .rank-cell{ font-weight:600; color: var(--text-muted); width:60px; text-align:left; }
    .manager-cell{ font-weight:500; white-space:nowrap; text-align:left; }
    .stat-cell{ text-align:left !important; }

    .top-rank{
      background: radial-gradient(circle at left, rgba(56,189,248,0.16), transparent 60%);
      box-shadow: inset 2px 0 0 rgba(56,189,248,0.8);
    }

    /* Sorted-column highlight (subtle) */
    .featured-col{
      background: rgba(56, 189, 248, 0.08);
    }
    .leaderboard-table thead th.featured-col{
      background: rgba(56, 189, 248, 0.12);
    }

    .no-data{
      font-size:0.9rem;
      color: var(--text-soft);
      padding: 14px 8px 4px;
    }
    .no-data span{
      border-radius:999px;
      border: 1px dashed rgba(75,85,99,0.9);
      padding: 6px 10px;
      display:inline-flex;
      gap:6px;
      align-items:center;
      background: rgba(15,23,42,0.85);
      font-size:0.78rem;
      text-transform:uppercase;
      letter-spacing:0.14em;
      line-height:1.25;
    }

    .pagination{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(31,41,55,0.75);
    }
    .page-btn{
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.85);
      color: #f9fafb;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 0.82rem;
      font-weight: 650;
      letter-spacing: 0.06em;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .page-btn:disabled{
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .page-btn:hover:not(:disabled){
      transform: translateY(-1px);
      border-color: rgba(56,189,248,0.7);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.25);
    }
    .page-meta{
      font-size: 0.78rem;
      color: var(--text-muted);
      letter-spacing: 0.14em;
      text-transform: uppercase;
      white-space:nowrap;
    }
    .page-status{
      font-size: 0.78rem;
      color: var(--text-soft);
      letter-spacing: 0.06em;
      white-space:nowrap;
    }

    .footer-note{
      margin-top: 14px;
      font-size: 0.75rem;
      color: var(--text-soft);
      text-align:right;
    }

    @media (max-width: 600px){
      .container{ padding: 22px 14px 20px; }
      .header h1{ font-size: 1.4rem; }
      .leaderboard-title{ font-size: 1rem; }
      .leaderboard-table th, .leaderboard-table td{ padding: 7px 6px; }
      .leaderboard-table{ min-width: 860px; }
    }
  </style>
</head>

<body>
  <div class="shell">
    <div class="container">
      <header class="header">
        <h1>Accolades</h1>
        <p>Legion of Whom Fantasy Football League · 2014–Present</p>
      </header>

      <section class="leaderboard-card">
        <div class="leaderboard-header">
          <div>
            <div class="leaderboard-title">Career Accolades</div>
            <div class="leaderboard-subtitle">Interactive table · click columns to sort</div>
          </div>
        </div>

        <div class="table-wrap">
          <table class="leaderboard-table" aria-live="polite">
            <thead>
              <tr id="headerRow"></tr>
            </thead>
            <tbody id="leaderboardBody"></tbody>
          </table>
        </div>

        <div class="pagination" id="pagination" aria-label="Pagination">
          <button class="page-btn" id="prevPage" type="button">Prev</button>
          <div class="page-meta" id="pageMeta">Page 1 of 1</div>
          <button class="page-btn" id="nextPage" type="button">Next</button>
          <div class="page-status" id="pageStatus">Showing 0–0 of 0</div>
        </div>

        <div class="no-data" id="noDataMessage">
          <span>Loading accolades…</span>
        </div>

        <div class="footer-note">
          Data sources: <strong>league-scores.json</strong> (live) · <strong>season-stats.json</strong> (season-final)
        </div>
      </section>
    </div>
  </div>

<script>
  // ---------------------------
  // Columns (single table)
  // ---------------------------
  const COLUMNS = [
    { key: "rank", label: "Rank", tooltip: "Rank based on the current sort column." },
    { key: "manager", label: "Manager", tooltip: "Team manager name." },
    { key: "championships", label: "Champ", tooltip: "Championships won" },
    { key: "championshipApps", label: "Champ App", tooltip: "Championship matchup appearances"},
    { key: "scoringTitles", label: "Scor Titl", tooltip: "Regular season scoring titles (most points for)"},
    { key: "semifinalApps", label: "SF App", tooltip: "Semifinal appearances" },
    { key: "firstRoundApps", label: "1st Rd App", tooltip: "First-round appearances"},
    { key: "playoffApps", label: "PO App", tooltip: "Playoff appearances"},
    { key: "avgFinish", label: "Avg Fin", tooltip: "Average final standing finish across completed seasons"},
    { key: "seasons", label: "Seas", tooltip: "Seasons in LWFFL"}
  ];

  // ---------------------------
  // State
  // ---------------------------
  let rawMatchups = [];
  let seasonStatsRaw = [];
  let rows = [];

  const paginationState = { pageSize: 25, currentPage: 1, totalRows: 0, totalPages: 1 };

  // Default sort: Championships (descending)
  const sortState = { key: "championships", dir: "desc" };

  // ---------------------------
  // Helpers
  // ---------------------------
  function compareValues(a, b, dir){
    if (a === b) return 0;
    if (a === null || a === undefined) return (dir === "asc") ? 1 : -1;
    if (b === null || b === undefined) return (dir === "asc") ? -1 : 1;

    if (typeof a === "string" || typeof b === "string"){
      return (dir === "asc") ? String(a).localeCompare(String(b)) : String(b).localeCompare(String(a));
    }
    return (dir === "asc") ? (a - b) : (b - a);
  }

  function formatCell(key, value){
    if (value === null || value === undefined || Number.isNaN(value)) return "-";
    if (key === "avgFinish") return Number(value).toFixed(2);
    if (typeof value === "number") return Number(value).toLocaleString("en-US", { maximumFractionDigits: 0 });
    return String(value);
  }

  function setNoData(message){
    document.getElementById("headerRow").innerHTML = "";
    document.getElementById("leaderboardBody").innerHTML = "";
    const noDataMessage = document.getElementById("noDataMessage");
    noDataMessage.style.display = "block";
    noDataMessage.querySelector("span").textContent = message;
    document.getElementById("pagination").style.display = "none";
  }

  function setPagination(totalRows){
    const paginationEl = document.getElementById("pagination");
    const prevBtn = document.getElementById("prevPage");
    const nextBtn = document.getElementById("nextPage");
    const pageMeta = document.getElementById("pageMeta");
    const pageStatus = document.getElementById("pageStatus");

    paginationState.totalRows = totalRows;
    paginationState.totalPages = Math.max(1, Math.ceil(totalRows / paginationState.pageSize));
    paginationState.currentPage = Math.min(paginationState.currentPage, paginationState.totalPages);

    paginationEl.style.display = totalRows > 0 ? "flex" : "none";
    pageMeta.textContent = `Page ${paginationState.currentPage} of ${paginationState.totalPages}`;

    const start = totalRows ? ((paginationState.currentPage - 1) * paginationState.pageSize + 1) : 0;
    const end = totalRows ? Math.min(paginationState.currentPage * paginationState.pageSize, totalRows) : 0;
    pageStatus.textContent = `Showing ${start}–${end} of ${totalRows}`;

    prevBtn.disabled = paginationState.currentPage <= 1;
    nextBtn.disabled = paginationState.currentPage >= paginationState.totalPages;
  }

  function paginateRows(list){
    const startIdx = (paginationState.currentPage - 1) * paginationState.pageSize;
    return list.slice(startIdx, startIdx + paginationState.pageSize);
  }

  function isPlayoffGame(m){
    return m && m.playoffs && m.playoffs !== "N/A";
  }

  function getPlayoffRound(year, week){
    // 2014–2020: R1=14, R2=15, Champ=16
    // 2021–Present: R1=15, R2=16, Champ=17
    if (year <= 2020){
      if (week === 14) return 1;
      if (week === 15) return 2;
      if (week === 16) return 3;
      return null;
    }
    if (week === 15) return 1;
    if (week === 16) return 2;
    if (week === 17) return 3;
    return null;
  }

  function ensureRow(manager){
    return {
      manager,
      championships: 0,
      championshipApps: 0,
      scoringTitles: 0,
      semifinalApps: 0,
      firstRoundApps: 0,
      playoffApps: 0,
      avgFinish: null,
      seasons: 0,
      // tiebreak determinism
      lastYear: 0,
      lastWeek: 0
    };
  }

  function buildAccoladesFromLeagueScores(matches){
    const map = {};
    const yearsByManager = {};
    const playoffByManagerYear = {}; // { mgr: { year: {r1,r2,r3} } }

    (matches || []).forEach(m => {
      if (!m) return;

      const y = Number(m.year);
      const w = Number(m.week);
      const participants = [m.manager1, m.manager2].filter(Boolean);

      participants.forEach(mgr => {
        if (!map[mgr]) map[mgr] = ensureRow(mgr);
        if (!yearsByManager[mgr]) yearsByManager[mgr] = new Set();
        yearsByManager[mgr].add(y);

        const r = map[mgr];
        if (y > r.lastYear || (y === r.lastYear && w > r.lastWeek)){
          r.lastYear = y;
          r.lastWeek = w;
        }
      });

      // Championships + round apps from playoff games
      if (!isPlayoffGame(m)) return;
      const round = getPlayoffRound(y, w);
      if (!round) return;

      participants.forEach(mgr => {
        if (!playoffByManagerYear[mgr]) playoffByManagerYear[mgr] = {};
        if (!playoffByManagerYear[mgr][y]) playoffByManagerYear[mgr][y] = { r1:false, r2:false, r3:false };
        playoffByManagerYear[mgr][y][`r${round}`] = true;
      });

      if (round === 1){
        participants.forEach(mgr => { map[mgr].firstRoundApps += 1; });
      }
      if (round === 2){
        participants.forEach(mgr => { map[mgr].semifinalApps += 1; });
      }
      if (round === 3){
        participants.forEach(mgr => { map[mgr].championshipApps += 1; });

        // Determine winner by score
        const s1 = Number(m.score1);
        const s2 = Number(m.score2);
        if (!Number.isNaN(s1) && !Number.isNaN(s2) && m.manager1 && m.manager2){
          if (s1 > s2) map[m.manager1].championships += 1;
          else if (s2 > s1) map[m.manager2].championships += 1;
          // ties are ignored (shouldn't happen)
        }
      }
    });

    // Seasons (unique years with any matchup)
    Object.keys(yearsByManager).forEach(mgr => {
      if (!map[mgr]) map[mgr] = ensureRow(mgr);
      map[mgr].seasons = yearsByManager[mgr].size;
    });

    // Playoff appearances (unique years with any playoff round)
    Object.keys(playoffByManagerYear).forEach(mgr => {
      if (!map[mgr]) map[mgr] = ensureRow(mgr);
      const years = playoffByManagerYear[mgr] || {};
      Object.keys(years).forEach(yStr => {
        const r = years[yStr];
        if (r && (r.r1 || r.r2 || r.r3)) map[mgr].playoffApps += 1;
      });
    });

    return map;
  }

  function applyScoringTitles(matches, map){
    const points = {}; // { year: { manager: total } }

    (matches || []).forEach(m => {
      if (!m || isPlayoffGame(m)) return;
      const y = Number(m.year);
      const s1 = Number(m.score1);
      const s2 = Number(m.score2);

      if (!points[y]) points[y] = {};
      
      if (m.manager1 && !Number.isNaN(s1)){
        points[y][m.manager1] = (points[y][m.manager1] || 0) + s1;
      }
      if (m.manager2 && !Number.isNaN(s2)){
        points[y][m.manager2] = (points[y][m.manager2] || 0) + s2;
      }
    });

    Object.keys(points).forEach(year => {
      const yearData = points[year];
      let maxP = -1;
      Object.values(yearData).forEach(p => {
        if (p > maxP) maxP = p;
      });

      if (maxP > 0){
        Object.keys(yearData).forEach(mgr => {
          if (Math.abs(yearData[mgr] - maxP) < 0.01){
            // Ensure row exists
            if (!map[mgr]) map[mgr] = ensureRow(mgr);
            map[mgr].scoringTitles += 1;
          }
        });
      }
    });
  }

  function applyAvgFinishFromSeasonStats(map, seasonStats){
    const sums = {};
    const counts = {};

    (seasonStats || []).forEach(row => {
      if (!row || !row.manager) return;
      const mgr = row.manager;
      const fs = Number(row.final_standing ?? row.finalStanding);
      if (Number.isNaN(fs) || fs <= 0) return;

      if (!sums[mgr]) sums[mgr] = 0;
      if (!counts[mgr]) counts[mgr] = 0;
      sums[mgr] += fs;
      counts[mgr] += 1;
    });

    Object.keys(sums).forEach(mgr => {
      if (!map[mgr]) map[mgr] = ensureRow(mgr);
      map[mgr].avgFinish = counts[mgr] ? (sums[mgr] / counts[mgr]) : null;
    });

    return map;
  }

  function buildHeaders(){
    const headerRow = document.getElementById("headerRow");
    headerRow.innerHTML = "";

    COLUMNS.forEach(col => {
      const th = document.createElement("th");
      th.textContent = col.label;

      // Hover details
      th.title = col.tooltip || "";

      // Sorted-column highlight
      if (col.key === sortState.key) th.classList.add("featured-col");

      th.addEventListener("click", () => {
        if (sortState.key === col.key){
          sortState.dir = (sortState.dir === "asc") ? "desc" : "asc";
        } else {
          sortState.key = col.key;
          // Default direction: rank/manager asc, avgFinish asc, everything else desc
          if (col.key === "manager") sortState.dir = "asc";
          else if (col.key === "avgFinish") sortState.dir = "asc";
          else sortState.dir = "desc";
        }
        paginationState.currentPage = 1;
        renderTable();
      });

      headerRow.appendChild(th);
    });
  }

  function renderTable(){
    if (!rows || !rows.length){
      setNoData("Note · No data available");
      return;
    }

    // Sort
    const sorted = rows.slice().sort((a,b) => {
      const cmp = compareValues(a[sortState.key], b[sortState.key], sortState.dir);
      if (cmp !== 0) return cmp;

      // deterministic tiebreak
      const ra = (a.lastYear || 0) * 100 + (a.lastWeek || 0);
      const rb = (b.lastYear || 0) * 100 + (b.lastWeek || 0);
      return rb - ra;
    });

    // Rank based on current sorted list
    sorted.forEach((r, idx) => { r.rank = idx + 1; });

    setPagination(sorted.length);
    const paged = paginateRows(sorted);

    // Headers (to update highlighted sorted col)
    buildHeaders();

    // Body
    const tbody = document.getElementById("leaderboardBody");
    tbody.innerHTML = "";
    document.getElementById("noDataMessage").style.display = "none";
    document.getElementById("pagination").style.display = "flex";

    paged.forEach(r => {
      const tr = document.createElement("tr");
      if (r.rank === 1) tr.classList.add("top-rank");

      COLUMNS.forEach(col => {
        const td = document.createElement("td");

        if (col.key === "rank") td.className = "rank-cell";
        else if (col.key === "manager") td.className = "manager-cell";
        else td.className = "stat-cell";

        // Sorted-column highlight for cells
        if (col.key === sortState.key) td.classList.add("featured-col");

        td.textContent = formatCell(col.key, r[col.key]);
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  }

  async function loadJSON(path){
    try{
      const res = await fetch(path);
      if (!res.ok){
        console.error(`Failed to load ${path}:`, res.status, res.statusText);
        return [];
      }
      return await res.json();
    } catch(err){
      console.error(`Error loading ${path}`, err);
      return [];
    }
  }

  // ---------------------------
  // Init
  // ---------------------------
  document.addEventListener("DOMContentLoaded", async () => {
    document.getElementById("noDataMessage").style.display = "block";
    document.getElementById("pagination").style.display = "none";

    rawMatchups = await loadJSON("league-scores.json");
    seasonStatsRaw = await loadJSON("season-stats.json");

    // Build from league-scores.json
    const map = buildAccoladesFromLeagueScores(rawMatchups);

    // Calculate Scoring Titles (regular season)
    applyScoringTitles(rawMatchups, map);

    // Apply avg finish from season-stats.json
    applyAvgFinishFromSeasonStats(map, seasonStatsRaw);

    // Final rows
    rows = Object.values(map);

    if (!rows.length){
      setNoData("Note · No data loaded yet");
      return;
    }

    // Wire pagination controls
    document.getElementById("prevPage").addEventListener("click", () => {
      if (paginationState.currentPage > 1){
        paginationState.currentPage -= 1;
        renderTable();
      }
    });
    document.getElementById("nextPage").addEventListener("click", () => {
      if (paginationState.currentPage < paginationState.totalPages){
        paginationState.currentPage += 1;
        renderTable();
      }
    });

    // Initial render (default: Championships sorted + highlighted)
    paginationState.currentPage = 1;
    renderTable();
  });
</script>
</body>
</html>
