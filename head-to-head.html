<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Head-to-Head – LWFFL</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-main: #020617;
      --card-bg: #020617;
      --accent: #38bdf8;
      --border-subtle: #1f2937;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --positive: #22c55e;
      --negative: #ef4444;
      --warning: #f59e0b;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0%, #020617 35%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 16px;
    }

    .shell { max-width: 1100px; margin: 24px auto; }

    .container {
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.18), transparent 55%),
        var(--card-bg);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 40px 80px rgba(0,0,0,0.8), 0 0 0 1px rgba(15,23,42,0.9);
      padding: 32px 24px;
      backdrop-filter: blur(14px);
    }

    .header { text-align: center; margin-bottom: 30px; }
    .header h1 {
      font-size: 2rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-weight: 700;
      margin-bottom: 6px;
      color: #f9fafb;
    }
    .header p {
      color: var(--text-soft);
      font-size: 0.9rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    /* Input Controls */
    .input-row {
      display: flex;
      gap: 15px;
      margin-bottom: 24px;
      align-items: flex-end;
      background: rgba(30, 41, 59, 0.4);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(55,65,81,0.5);
    }
    .input-group { flex: 1; }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-muted);
      font-weight: 600;
      font-size: 0.8rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    select {
      width: 100%;
      padding: 12px 15px;
      background-color: #0b1120;
      border: 1px solid rgba(75, 85, 99, 0.8);
      border-radius: 8px;
      color: #f9fafb;
      font-size: 1.1em;
      transition: border-color 0.2s;
      appearance: none;
      cursor: pointer;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2338bdf8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1em;
    }
    select:disabled { opacity: 0.5; cursor: wait; }
    select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 1px rgba(56,189,248,0.5); }

    /* Stats Grid */
    .stats-banner-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 24px;
      display: none; /* Hidden until data loaded */
    }
    .stats-banner-grid.active { display: grid; }

    .stat-banner {
      background: radial-gradient(circle at center, rgba(56,189,248,0.15), transparent 70%);
      border: 1px solid rgba(56,189,248,0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .stat-banner-label {
      color: var(--accent);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 5px;
      min-height: 1.2em;
    }
    .stat-banner-val {
      font-size: 2rem;
      font-weight: 800;
      color: #fff;
    }
    .stat-sub {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 5px;
    }

    /* Results Card */
    .result-card {
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(2,6,23,0.95));
      border: 1px solid rgba(55,65,81,0.6);
      border-radius: 14px;
      padding: 24px;
      display: none;
    }
    .result-card.active { display: block; }

    .table-header {
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }
    .table-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .table-wrap {
      width: 100%;
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.5);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      min-width: 700px;
    }

    .data-table thead { background: rgba(30, 41, 59, 0.6); }

    .data-table th {
      text-align: left;
      padding: 14px 16px;
      color: var(--text-muted);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      border-bottom: 1px solid rgba(55,65,81,0.5);
      user-select: none;
    }

    .data-table td {
      padding: 14px 16px;
      color: #e5e7eb;
      border-bottom: 1px solid rgba(55, 65, 81, 0.3);
      font-variant-numeric: tabular-nums;
    }

    .data-table tbody tr:hover { background: rgba(56, 189, 248, 0.05); }

    /* Custom Styles for H2H Table */
    .score-cell { font-weight: 700; }
    .score-win { color: var(--positive); }
    .score-loss { color: var(--negative); opacity: 0.8; }
    
    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border: 1px solid rgba(148,163,184,0.3);
      background: rgba(15,23,42,0.6);
      color: var(--text-soft);
    }
    .pill.playoff {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
      color: var(--accent);
    }

    .series-meta {
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(30, 41, 59, 0.3);
      border-radius: 8px;
      border: 1px dashed rgba(75, 85, 99, 0.5);
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.6;
    }
    .series-meta strong { color: #f9fafb; font-weight: 600; }

    /* Loading / Empty States */
    .status-msg {
      text-align: center;
      padding: 40px;
      color: var(--text-soft);
      font-size: 0.95rem;
    }

    @media (max-width: 768px) {
      .input-row { flex-direction: column; }
      .stats-banner-grid { grid-template-columns: 1fr; }
      .stat-banner-val { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
<div id="nav-placeholder"></div>
<div class="shell">
  <div class="container">
    <div class="header">
      <h1>Head-to-Head</h1>
      <p>Compare Matchup History</p>
    </div>

    <div class="input-row">
      <div class="input-group">
        <label for="manager1Select">Manager 1</label>
        <select id="manager1Select" disabled>
          <option value="">Loading...</option>
        </select>
      </div>
      <div class="input-group">
        <label for="manager2Select">Manager 2</label>
        <select id="manager2Select" disabled>
          <option value="">Loading...</option>
        </select>
      </div>
      <div class="input-group">
        <label for="gameTypeSelect">Filter</label>
        <select id="gameTypeSelect">
          <option value="all" selected>All Games</option>
          <option value="regular">Regular Season</option>
          <option value="playoffs">Playoffs Only</option>
        </select>
      </div>
    </div>

    <div id="statsGrid" class="stats-banner-grid">
      <div class="stat-banner">
        <div class="stat-banner-label" id="lblBanner1">Manager 1</div>
        <div class="stat-banner-val" id="valBanner1">-</div>
        <div class="stat-sub" id="subBanner1">Wins</div>
      </div>
      <div class="stat-banner">
        <div class="stat-banner-label" id="lblBanner2">Manager 2</div>
        <div class="stat-banner-val" id="valBanner2">-</div>
        <div class="stat-sub" id="subBanner2">Wins</div>
      </div>
      <div class="stat-banner">
        <div class="stat-banner-label">Current Streak</div>
        <div class="stat-banner-val" id="valStreak">-</div>
        <div class="stat-sub" id="subStreak">Since Last Game</div>
      </div>
    </div>

    <div id="resultsArea" class="result-card">
      <div class="table-header">
        <div class="table-title">Matchup Log</div>
      </div>
      
      <div id="seriesMeta" class="series-meta"></div>

      <div class="table-wrap">
        <table class="data-table" id="matchupTable">
          <thead>
            <tr>
              <th>Year</th>
              <th>Week</th>
              <th>Type</th>
              <th>Manager 1</th>
              <th>Score</th>
              <th>Score</th>
              <th>Manager 2</th>
            </tr>
          </thead>
          <tbody id="matchupBody"></tbody>
        </table>
      </div>
    </div>

    <div id="statusMsg" class="status-msg">
      Select two managers above to view their history.
    </div>

  </div>
</div>

<script>
  let matchupDatabase = [];
  
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const res = await fetch('league-scores.json');
      if (!res.ok) throw new Error("File load error");
      matchupDatabase = await res.json();
      
      initDropdowns();
    } catch (err) {
      console.error(err);
      document.getElementById('statusMsg').textContent = "Error loading data file.";
    }
  });

  function initDropdowns() {
    const m1Sel = document.getElementById('manager1Select');
    const m2Sel = document.getElementById('manager2Select');
    
    // Extract unique managers
    const managers = new Set();
    matchupDatabase.forEach(m => {
      if(m.manager1) managers.add(m.manager1);
      if(m.manager2) managers.add(m.manager2);
    });
    const sortedMgrs = Array.from(managers).sort();

    m1Sel.innerHTML = '<option value="">Select Manager...</option>';
    m2Sel.innerHTML = '<option value="">Select Manager...</option>';
    
    // Special 'All' option for Manager 2
    const allOpt = document.createElement('option');
    allOpt.value = "ALL";
    allOpt.textContent = "All Opponents";
    m2Sel.appendChild(allOpt);

    sortedMgrs.forEach(m => {
      m1Sel.appendChild(createOption(m));
      m2Sel.appendChild(createOption(m));
    });

    m1Sel.disabled = false;
    m2Sel.disabled = false;

    // Listeners
    m1Sel.addEventListener('change', updateView);
    m2Sel.addEventListener('change', updateView);
    document.getElementById('gameTypeSelect').addEventListener('change', updateView);
  }

  function createOption(val) {
    const opt = document.createElement('option');
    opt.value = val;
    opt.textContent = val;
    return opt;
  }

  function updateView() {
    const m1 = document.getElementById('manager1Select').value;
    const m2 = document.getElementById('manager2Select').value;
    const filter = document.getElementById('gameTypeSelect').value;
    
    const statusEl = document.getElementById('statusMsg');
    const statsGrid = document.getElementById('statsGrid');
    const resultsArea = document.getElementById('resultsArea');

    // Validation
    if (!m1 || !m2) {
      statusEl.textContent = "Select two managers above to view their history.";
      statusEl.style.display = 'block';
      statsGrid.classList.remove('active');
      resultsArea.classList.remove('active');
      return;
    }
    
    if (m1 === m2 && m2 !== "ALL") {
      statusEl.textContent = "Please select two different managers.";
      statusEl.style.display = 'block';
      statsGrid.classList.remove('active');
      resultsArea.classList.remove('active');
      return;
    }

    // Filter Data
    let matchups = matchupDatabase.filter(g => {
      // Logic for M1 vs M2
      let involved = false;
      if (m2 === 'ALL') {
        involved = (g.manager1 === m1 || g.manager2 === m1);
      } else {
        involved = (g.manager1 === m1 && g.manager2 === m2) || (g.manager1 === m2 && g.manager2 === m1);
      }
      if (!involved) return false;

      // Logic for Type
      const isPlayoff = checkPlayoff(g.year, g.week) !== null;
      if (filter === 'regular' && isPlayoff) return false;
      if (filter === 'playoffs' && !isPlayoff) return false;

      return true;
    });

    // Sort: Newest first
    matchups.sort((a,b) => {
      if (a.year !== b.year) return b.year - a.year;
      return b.week - a.week;
    });

    if (matchups.length === 0) {
      statusEl.textContent = "No matchups found for this criteria.";
      statusEl.style.display = 'block';
      statsGrid.classList.remove('active');
      resultsArea.classList.remove('active');
      return;
    }

    // Show UI
    statusEl.style.display = 'none';
    statsGrid.classList.add('active');
    resultsArea.classList.add('active');

    renderStats(m1, m2, matchups);
    renderTable(m1, m2, matchups);
  }

  function checkPlayoff(year, week) {
    const y = Number(year);
    const w = Number(week);
    
    if (y >= 2014 && y <= 2020) {
      if (w === 14) return "First Round";
      if (w === 15) return "Semis";
      if (w === 16) return "Finals";
    } else if (y >= 2021) {
      if (w === 15) return "First Round";
      if (w === 16) return "Semis";
      if (w === 17) return "Finals";
    }
    return null;
  }

  function renderStats(m1, m2, data) {
    let m1Wins = 0, m2Wins = 0, ties = 0;
    let m1Pts = 0, m2Pts = 0;

    const results = []; // For streak calc

    data.forEach(g => {
      let s1 = 0, s2 = 0;
      // Normalize Score 1 to Manager 1
      if (g.manager1 === m1) {
        s1 = Number(g.score1);
        s2 = Number(g.score2);
      } else {
        s1 = Number(g.score2);
        s2 = Number(g.score1);
      }

      m1Pts += s1;
      m2Pts += s2;

      if (s1 > s2) { m1Wins++; results.push('W'); }
      else if (s2 > s1) { m2Wins++; results.push('L'); }
      else { ties++; results.push('T'); }
    });

    // Update Banners
    const m2Display = m2 === 'ALL' ? 'Opponents' : m2;
    
    document.getElementById('lblBanner1').textContent = m1;
    document.getElementById('valBanner1').textContent = m1Wins;
    document.getElementById('subBanner1').textContent = `Win(s)`;

    document.getElementById('lblBanner2').textContent = m2Display;
    document.getElementById('valBanner2').textContent = m2Wins;
    document.getElementById('subBanner2').textContent = `Win(s)`;

    // Streak
    let streakVal = 0, streakType = '';
    if (results.length > 0) {
      streakType = results[0];
      for(let r of results) {
        if (r === streakType) streakVal++;
        else break;
      }
    }
    
    const streakOwner = streakType === 'W' ? m1 : (streakType === 'L' ? m2Display : 'Tie');
    const colorClass = streakType === 'W' ? 'score-win' : (streakType === 'L' ? 'score-loss' : '');
    
    const streakEl = document.getElementById('valStreak');
    streakEl.textContent = streakVal > 0 ? `${streakType}${streakVal}` : '-';
    streakEl.className = `stat-banner-val ${colorClass}`;

    document.getElementById('subStreak').textContent = streakVal > 0 ? `${streakOwner} Streak` : 'No Streak';

    // Meta Box Text
    document.getElementById('seriesMeta').innerHTML = `
      <strong>Cumulative Score:</strong> ${m1} <strong>${m1Pts.toLocaleString()}</strong> — ${m2Display} <strong>${m2Pts.toLocaleString()}</strong><br>
      <strong>Average Score:</strong> ${m1} <strong>${(m1Pts/data.length).toFixed(2)}</strong> — <strong>${m2Display} ${(m2Pts/data.length).toFixed(2)}</strong>
    `;
  }

  function renderTable(m1, m2, data) {
    const tbody = document.getElementById('matchupBody');
    tbody.innerHTML = '';

    data.forEach(g => {
      const playoffName = checkPlayoff(g.year, g.week);
      const isPlayoff = playoffName !== null;
      
      let p1Name, p1Score, p2Name, p2Score;
      
      // If Specific Comparison, Keep M1 on Left
      if (m2 !== 'ALL') {
        if (g.manager1 === m1) {
          p1Name = g.manager1; p1Score = g.score1;
          p2Name = g.manager2; p2Score = g.score2;
        } else {
          p1Name = g.manager2; p1Score = g.score2;
          p2Name = g.manager1; p2Score = g.score1;
        }
      } else {
        // If "ALL", just list them as they are in DB, but ensure M1 is highlighted if present?
        // Actually for consistency, let's always put the selected M1 on the left.
        if (g.manager1 === m1) {
          p1Name = g.manager1; p1Score = g.score1;
          p2Name = g.manager2; p2Score = g.score2;
        } else {
          p1Name = g.manager2; p1Score = g.score2;
          p2Name = g.manager1; p2Score = g.score1;
        }
      }

      const s1 = Number(p1Score);
      const s2 = Number(p2Score);
      const c1 = s1 > s2 ? 'score-win' : (s1 < s2 ? 'score-loss' : '');
      const c2 = s2 > s1 ? 'score-win' : (s2 < s1 ? 'score-loss' : '');

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${g.year}</td>
        <td>Week ${g.week}</td>
        <td>
          <span class="pill ${isPlayoff ? 'playoff' : ''}">
            ${isPlayoff ? playoffName : 'Reg Season'}
          </span>
        </td>
        <td>${p1Name}</td>
        <td class="score-cell ${c1}">${s1.toFixed(2)}</td>
        <td class="score-cell ${c2}">${s2.toFixed(2)}</td>
        <td>${p2Name}</td>
      `;
      tbody.appendChild(tr);
    });
  }

</script>
<script src="nav-loader.js"></script>
</body>
</html>
