<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Manager Profile ‚Äì LWFFL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-main: #020617;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-dim: rgba(56, 189, 248, 0.1);
      --border-subtle: #1f2937;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --positive: #22c55e;
      --negative: #ef4444;
      --warning: #f59e0b;
      --gold: #fbbf24;
      --silver: #94a3b8;
      --bronze: #78350f;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0%, #020617 35%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 16px;
    }

    .shell { max-width: 1200px; margin: 0 auto; }

    /* Header / Controls */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .page-title {
      font-size: 1.2rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .manager-select-wrapper {
      position: relative;
      min-width: 250px;
    }

    select {
      width: 100%;
      padding: 10px 14px;
      background-color: rgba(15, 23, 42, 0.8);
      border: 1px solid var(--accent);
      border-radius: 8px;
      color: #f9fafb;
      font-size: 1rem;
      font-weight: 600;
      appearance: none;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(56, 189, 248, 0.1);
    }
    
    /* Dashboard Grid (Bento Box Style) */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 300px 1fr;
      grid-template-rows: auto auto;
      gap: 20px;
      margin-bottom: 32px;
    }

    /* Common Card Style */
    .card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.08), transparent 70%), var(--card-bg);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }

    /* 1. Hero Profile Card */
    .hero-card {
      grid-row: span 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 800;
      color: #fff;
      margin-bottom: 16px;
      border: 4px solid rgba(15, 23, 42, 0.8);
      box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
    }

    .hero-name {
      font-size: 1.8rem;
      font-weight: 800;
      margin-bottom: 8px;
      line-height: 1.1;
    }

    .hero-tenure {
      color: var(--text-muted);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 20px;
    }

    .ovr-badge {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 10px 20px;
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .ovr-val { font-size: 2.2rem; font-weight: 900; color: var(--accent); line-height: 1; }
    .ovr-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.2em; color: var(--text-soft); margin-top: 4px; }

    .trophy-case {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding-top: 20px;
      border-top: 1px solid var(--border-subtle);
    }
    .trophy {
      font-size: 1.2rem;
      background: rgba(255,255,255,0.05);
      padding: 6px;
      border-radius: 6px;
      cursor: help;
    }

    /* 2. Key Stats Strip */
    .stats-strip {
      grid-column: 2;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }

    .stat-box {
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    .stat-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.05em; margin-bottom: 6px; }
    .stat-val { font-size: 1.4rem; font-weight: 700; color: #fff; }
    .stat-sub { font-size: 0.75rem; color: var(--text-soft); }

    /* 3. Analytics Area */
    .analytics-grid {
      grid-column: 2;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .chart-card {
      min-height: 300px;
      display: flex;
      flex-direction: column;
    }

    .chart-card h3 {
      font-size: 0.9rem;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 16px;
      border-left: 3px solid var(--accent);
      padding-left: 10px;
    }

    .chart-container {
      position: relative;
      flex: 1;
      width: 100%;
      min-height: 200px;
    }

    /* Full Width Heatmap */
    .heatmap-card {
      grid-column: 1 / -1; /* Span full width */
    }

    .heatmap-grid {
      display: grid;
      grid-template-columns: 50px repeat(17, 1fr); /* Year label + 17 weeks */
      gap: 4px;
      overflow-x: auto;
    }
    .hm-cell {
      aspect-ratio: 1;
      border-radius: 3px;
      background: rgba(255,255,255,0.05);
      position: relative;
    }
    .hm-cell:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #000;
      color: #fff;
      padding: 4px 8px;
      font-size: 0.7rem;
      border-radius: 4px;
      white-space: nowrap;
      pointer-events: none;
      z-index: 10;
    }
    .hm-win { background: var(--positive); opacity: 0.8; }
    .hm-loss { background: var(--negative); opacity: 0.8; }
    .hm-tie { background: var(--warning); opacity: 0.8; }
    .hm-year { 
      font-size: 0.75rem; 
      color: var(--text-muted); 
      display: flex; 
      align-items: center; 
    }
    .hm-header {
      font-size: 0.65rem;
      text-align: center;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    /* Tabs & Tables */
    .tabs-nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-subtle);
      padding-bottom: 10px;
    }
    
    .tab-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      padding: 8px 16px;
      cursor: pointer;
      position: relative;
    }
    
    .tab-btn.active { color: var(--accent); }
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -11px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--accent);
    }

    .table-section { display: none; animation: fadeIn 0.3s; }
    .table-section.active { display: block; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .table-wrap {
      overflow-x: auto;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
    }

    table { width: 100%; border-collapse: collapse; min-width: 600px; font-size: 0.9rem; }
    thead { background: rgba(30, 41, 59, 0.5); }
    th { text-align: left; padding: 12px; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; }
    td { padding: 12px; border-bottom: 1px solid var(--border-subtle); color: #e5e7eb; }
    tr:last-child td { border-bottom: none; }
    
    .w-text { color: var(--positive); font-weight: 700; }
    .l-text { color: var(--negative); font-weight: 700; }

    /* Responsive */
    @media (max-width: 900px) {
      .dashboard-grid { grid-template-columns: 1fr; grid-template-rows: auto; }
      .hero-card { grid-row: auto; display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 20px; text-align: left; }
      .avatar { margin-bottom: 0; width: 80px; height: 80px; font-size: 2rem; }
      .hero-tenure { margin-bottom: 5px; }
      .ovr-badge { margin-bottom: 0; }
      .trophy-case { grid-column: span 3; justify-content: flex-start; }
      
      .analytics-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 600px) {
      .hero-card { display: flex; flex-direction: column; text-align: center; }
      .stats-strip { grid-template-columns: 1fr 1fr; }
      .trophy-case { justify-content: center; }
    }
  </style>
</head>
<body>

<div class="shell">
  
  <div class="top-bar">
    <div class="page-title">Manager Card</div>
    <div class="manager-select-wrapper">
      <select id="managerSelect"></select>
    </div>
  </div>

  <div class="dashboard-grid">
    
    <div class="card hero-card">
      <div class="avatar" id="heroAvatar">RC</div>
      <div style="flex:1;">
        <div class="hero-name" id="heroName">Loading...</div>
        <div class="hero-tenure" id="heroTenure">Est. 2014</div>
        <div class="trophy-case" id="trophyCase">
          </div>
      </div>
      <div class="ovr-badge">
        <span class="ovr-val" id="heroOvr">--</span>
        <span class="ovr-label">OVR</span>
      </div>
    </div>

    <div class="stats-strip">
      <div class="stat-box">
        <div class="stat-label">Career Record</div>
        <div class="stat-val" id="statRecord">-</div>
        <div class="stat-sub" id="statWinPct">.000</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Avg Finish</div>
        <div class="stat-val" id="statAvgFinish">-</div>
        <div class="stat-sub">Rank</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Avg Score</div>
        <div class="stat-val" id="statAvgScore">-</div>
        <div class="stat-sub">PTS/Game</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Career Earnings</div>
        <div class="stat-val" id="statEarnings" style="color:var(--gold)">$-</div>
        <div class="stat-sub">Total Won</div>
      </div>
    </div>

    <div class="analytics-grid">
      
      <div class="card chart-card">
        <h3>Luck Index (PF vs PA)</h3>
        <div class="chart-container">
          <canvas id="luckChart"></canvas>
        </div>
      </div>

      <div class="card chart-card">
        <h3>Yearly Scoring Spread</h3>
        <div class="chart-container">
          <canvas id="spreadChart"></canvas>
        </div>
      </div>

      <div class="card chart-card">
        <h3>Rivalry Radar</h3>
        <div class="chart-container">
          <canvas id="radarChart"></canvas>
        </div>
      </div>

      <div class="card chart-card">
        <h3>Clutch Factor (Reg vs Playoff)</h3>
        <div class="chart-container">
          <canvas id="clutchChart"></canvas>
        </div>
      </div>

      <div class="card chart-card" style="grid-column: 1 / -1;">
        <h3>Cumulative Points Race</h3>
        <div class="chart-container">
          <canvas id="cumulativeChart"></canvas>
        </div>
      </div>

      <div class="card heatmap-card">
        <h3>The Heat Check (Weekly Results)</h3>
        <div class="heatmap-grid" id="heatmapGrid">
          </div>
      </div>

    </div>

  </div>

  <div class="card">
    <div class="tabs-nav">
      <button class="tab-btn active" onclick="switchTab('seasons')">Season Log</button>
      <button class="tab-btn" onclick="switchTab('games')">Game Log</button>
    </div>

    <div id="tabSeasons" class="table-section active">
      <div class="table-wrap">
        <table id="seasonTable">
          <thead>
            <tr>
              <th>Year</th>
              <th>Record</th>
              <th>Finish</th>
              <th>Points For</th>
              <th>Points Against</th>
              <th>Playoff Seed</th>
              <th>Earnings</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div id="tabGames" class="table-section">
      <div class="table-wrap">
        <table id="gameTable">
          <thead>
            <tr>
              <th>Year</th>
              <th>Week</th>
              <th>Opponent</th>
              <th>Score</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script>
  // --- Global Data ---
  let rawScores = [];
  let rawStandings = [];
  let rawSeeds = [];
  
  let currentManager = "";
  
  // Chart Instances
  let charts = {};

  // --- Constants ---
  const PAYOUTS = { 1: 450, 2: 175, 3: 100, 4: 75 };

  // --- Init ---
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const [sRes, stRes, sdRes] = await Promise.all([
        fetch('league-scores.json'),
        fetch('final-standings.json'),
        fetch('playoff-seeds.json')
      ]);

      if(!sRes.ok || !stRes.ok || !sdRes.ok) throw new Error("Data load failed");

      rawScores = await sRes.json();
      rawStandings = await stRes.json();
      rawSeeds = await sdRes.json();

      initManagerDropdown();
      
      const firstMgr = document.getElementById('managerSelect').options[0].value;
      loadManager(firstMgr);

    } catch (err) {
      console.error(err);
      document.querySelector('.shell').innerHTML = `<div style="text-align:center; padding:50px; color:#666;">Error loading data files.</div>`;
    }
  });

  function initManagerDropdown() {
    const managers = new Set();
    rawStandings.forEach(s => { if(s.manager) managers.add(s.manager); });
    
    const select = document.getElementById('managerSelect');
    Array.from(managers).sort().forEach(m => {
      const opt = document.createElement('option');
      opt.value = m;
      opt.textContent = m;
      select.appendChild(opt);
    });

    select.addEventListener('change', (e) => loadManager(e.target.value));
  }

  // --- Main Logic ---

  function loadManager(name) {
    currentManager = name;
    
    // 1. Data Processing
    const mySeasons = rawStandings.filter(s => s.manager === name).sort((a,b) => b.year - a.year);
    const myGames = [];
    const allLeagueGames = []; // Needed for league averages

    rawScores.forEach(m => {
      // Process my games
      let isMyGame = false;
      let myScore = 0;
      let oppScore = 0;
      let oppName = "";

      if(m.manager1 === name) {
        isMyGame = true;
        myScore = Number(m.score1);
        oppScore = Number(m.score2);
        oppName = m.manager2;
      } else if (m.manager2 === name) {
        isMyGame = true;
        myScore = Number(m.score2);
        oppScore = Number(m.score1);
        oppName = m.manager1;
      }

      if (isMyGame && !isNaN(myScore)) {
        const result = myScore > oppScore ? 'W' : (myScore < oppScore ? 'L' : 'T');
        myGames.push({
          year: Number(m.year),
          week: Number(m.week),
          score: myScore,
          oppScore: oppScore,
          opponent: oppName,
          result: result,
          isPlayoff: (m.playoffs && m.playoffs !== "N/A")
        });
      }

      // Collect league-wide scores for cumulative avg
      if (!isNaN(m.score1)) allLeagueGames.push({ year:Number(m.year), week:Number(m.week), score:Number(m.score1) });
      if (!isNaN(m.score2)) allLeagueGames.push({ year:Number(m.year), week:Number(m.week), score:Number(m.score2) });
    });

    // 2. Render Components
    renderHero(name, mySeasons, myGames);
    renderStats(mySeasons, myGames);
    renderTables(mySeasons, myGames);
    
    // 3. Render Advanced Charts
    renderLuckChart(mySeasons);
    renderSpreadChart(myGames);
    renderRadarChart(myGames);
    renderClutchChart(myGames);
    renderCumulativeChart(myGames, allLeagueGames);
    renderHeatmap(myGames);
  }

  // --- Render Functions ---

  function renderHero(name, seasons, games) {
    const initials = name.split(' ').map(n => n[0]).join('').substring(0,2);
    document.getElementById('heroAvatar').textContent = initials;
    document.getElementById('heroName').textContent = name;
    
    if(seasons.length > 0) {
      const minYear = Math.min(...seasons.map(s => s.year));
      const maxYear = Math.max(...seasons.map(s => s.year));
      document.getElementById('heroTenure').textContent = `Active ${minYear} ‚Äì ${maxYear === new Date().getFullYear() ? 'Present' : maxYear}`;
    }

    const caseEl = document.getElementById('trophyCase');
    caseEl.innerHTML = '';
    let champCount = 0;
    seasons.forEach(s => {
      const rank = s.final_standing ?? s.finalStanding;
      if (rank === 1) { champCount++; caseEl.innerHTML += `<span class="trophy" title="${s.year} Champion">üèÜ</span>`; }
      else if (rank === 2) caseEl.innerHTML += `<span class="trophy" title="${s.year} Runner-up">ü•à</span>`;
      else if (rank === 3) caseEl.innerHTML += `<span class="trophy" title="${s.year} 3rd Place">ü•â</span>`;
    });

    const wins = games.filter(g => g.result === 'W').length;
    const winPct = games.length ? wins / games.length : 0;
    const seeds = rawSeeds.filter(s => s.manager === name);
    const playoffApps = seeds.length;

    let ovr = 60 + (winPct * 25) + (champCount * 8) + (playoffApps * 1.5);
    if(ovr > 99) ovr = 99;
    document.getElementById('heroOvr').textContent = Math.round(ovr);
  }

  function renderStats(seasons, games) {
    const w = games.filter(g => g.result === 'W').length;
    const l = games.filter(g => g.result === 'L').length;
    const t = games.filter(g => g.result === 'T').length;
    document.getElementById('statRecord').textContent = `${w}-${l}-${t}`;
    
    const pct = games.length ? (w + t*0.5) / games.length : 0;
    document.getElementById('statWinPct').textContent = pct.toFixed(3);

    const validFinishes = seasons.map(s => s.final_standing ?? s.finalStanding).filter(f => f);
    const avgFin = validFinishes.length ? validFinishes.reduce((a,b)=>a+b,0) / validFinishes.length : 0;
    document.getElementById('statAvgFinish').textContent = avgFin > 0 ? avgFin.toFixed(1) : '-';

    const totalScore = games.reduce((a,b) => a + b.score, 0);
    const avgScore = games.length ? totalScore / games.length : 0;
    document.getElementById('statAvgScore').textContent = avgScore.toFixed(1);

    let money = 0;
    seasons.forEach(s => {
      const rank = s.final_standing ?? s.finalStanding;
      if (PAYOUTS[rank]) money += PAYOUTS[rank];
    });
    document.getElementById('statEarnings').textContent = `$${money.toLocaleString()}`;
  }

  function renderTables(seasons, games) {
    const tbodyS = document.querySelector('#seasonTable tbody');
    tbodyS.innerHTML = '';
    seasons.forEach(s => {
      const wins = s.wins || 0;
      const losses = s.losses || 0;
      const ties = s.ties || 0;
      const seedData = rawSeeds.find(sd => sd.manager === currentManager && sd.year === s.year);
      const seed = seedData ? seedData.seed : '-';
      let money = 0;
      const rank = s.final_standing ?? s.finalStanding;
      if (PAYOUTS[rank]) money = PAYOUTS[rank];

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${s.year}</td>
        <td>${wins}-${losses}-${ties}</td>
        <td>${rank || '-'}</td>
        <td>${(s.points_for || 0).toLocaleString()}</td>
        <td>${(s.points_against || 0).toLocaleString()}</td>
        <td>${seed}</td>
        <td style="color:${money>0?'var(--gold)':'inherit'}">${money > 0 ? '$'+money : '-'}</td>
      `;
      tbodyS.appendChild(tr);
    });

    const tbodyG = document.querySelector('#gameTable tbody');
    tbodyG.innerHTML = '';
    const recentGames = [...games].sort((a,b) => {
      if(a.year !== b.year) return b.year - a.year;
      return b.week - a.week;
    }).slice(0, 50);

    recentGames.forEach(g => {
      const tr = document.createElement('tr');
      const resClass = g.result === 'W' ? 'w-text' : (g.result === 'L' ? 'l-text' : '');
      tr.innerHTML = `
        <td>${g.year}</td>
        <td>Week ${g.week}</td>
        <td>${g.opponent}</td>
        <td style="font-weight:700;">${g.score.toFixed(2)}</td>
        <td class="${resClass}">${g.result}</td>
      `;
      tbodyG.appendChild(tr);
    });
  }

  // --- Charts Implementation ---

  // 1. Luck Index (PF vs PA Scatter)
  function renderLuckChart(seasons) {
    const data = seasons.map(s => ({
      x: s.points_for,
      y: s.points_against,
      year: s.year
    }));

    const ctx = document.getElementById('luckChart').getContext('2d');
    if (charts.luck) charts.luck.destroy();

    charts.luck = new Chart(ctx, {
      type: 'scatter',
      data: {
        datasets: [{
          label: 'Season',
          data: data,
          backgroundColor: '#38bdf8',
          borderColor: '#fff',
          borderWidth: 1,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.raw.year}: PF ${ctx.raw.x}, PA ${ctx.raw.y}`
            }
          }
        },
        scales: {
          x: { 
            title: { display: true, text: 'Points Scored (PF)', color: '#6b7280' },
            grid: { color: 'rgba(255,255,255,0.05)' }
          },
          y: { 
            title: { display: true, text: 'Points Against (PA)', color: '#6b7280' },
            grid: { color: 'rgba(255,255,255,0.05)' }
          }
        }
      }
    });
  }

  // 2. Yearly Scoring Spread (Floating Bars)
  function renderSpreadChart(games) {
    const years = [...new Set(games.map(g => g.year))].sort((a,b)=>a-b);
    const spreadData = years.map(y => {
      const scores = games.filter(g => g.year === y).map(g => g.score);
      return [Math.min(...scores), Math.max(...scores)];
    });

    const ctx = document.getElementById('spreadChart').getContext('2d');
    if (charts.spread) charts.spread.destroy();

    charts.spread = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: years,
        datasets: [{
          label: 'Score Range',
          data: spreadData,
          backgroundColor: 'rgba(56, 189, 248, 0.5)',
          borderColor: '#38bdf8',
          borderWidth: 1,
          borderSkipped: false,
          barPercentage: 0.5
        }]
      },
      options: {
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { min: 50, grid: { color: 'rgba(255,255,255,0.05)' } },
          x: { grid: { display: false } }
        }
      }
    });
  }

  // 3. Rivalry Radar
  function renderRadarChart(games) {
    const opps = {};
    games.forEach(g => {
      if(!g.opponent) return;
      if(!opps[g.opponent]) opps[g.opponent] = { w:0, total:0 };
      opps[g.opponent].total++;
      if(g.result === 'W') opps[g.opponent].w++;
    });

    // Filter to top 5 rivals by games played to keep chart clean
    const topRivals = Object.keys(opps)
      .sort((a,b) => opps[b].total - opps[a].total)
      .slice(0, 6);

    const labels = topRivals;
    const data = topRivals.map(r => (opps[r].w / opps[r].total) * 100);

    const ctx = document.getElementById('radarChart').getContext('2d');
    if (charts.radar) charts.radar.destroy();

    charts.radar = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Win %',
          data: data,
          fill: true,
          backgroundColor: 'rgba(239, 68, 68, 0.2)',
          borderColor: '#ef4444',
          pointBackgroundColor: '#fff',
          pointBorderColor: '#ef4444'
        }]
      },
      options: {
        maintainAspectRatio: false,
        scales: {
          r: {
            angleLines: { color: 'rgba(255,255,255,0.1)' },
            grid: { color: 'rgba(255,255,255,0.1)' },
            pointLabels: { color: '#9ca3af', font: { size: 10 } },
            ticks: { display: false, max: 100, min: 0 }
          }
        },
        plugins: { legend: { display: false } }
      }
    });
  }

  // 4. Clutch Factor (Reg vs Playoff)
  function renderClutchChart(games) {
    const regScores = games.filter(g => !g.isPlayoff).map(g => g.score);
    const playScores = games.filter(g => g.isPlayoff).map(g => g.score);

    const regAvg = regScores.length ? regScores.reduce((a,b)=>a+b,0)/regScores.length : 0;
    const playAvg = playScores.length ? playScores.reduce((a,b)=>a+b,0)/playScores.length : 0;

    const ctx = document.getElementById('clutchChart').getContext('2d');
    if (charts.clutch) charts.clutch.destroy();

    charts.clutch = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Reg. Season', 'Playoffs'],
        datasets: [{
          data: [regAvg, playAvg],
          backgroundColor: ['#38bdf8', '#fbbf24'],
          borderRadius: 6
        }]
      },
      options: {
        maintainAspectRatio: false,
        indexAxis: 'y',
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { color: 'rgba(255,255,255,0.05)' } },
          y: { grid: { display: false }, ticks: { color: '#fff' } }
        }
      }
    });
  }

  // 5. Cumulative Points Race
  function renderCumulativeChart(myGames, leagueGames) {
    // Sort chronological
    const mySorted = [...myGames].sort((a,b) => (a.year - b.year) || (a.week - b.week));
    
    // Group league games by index (Game 1, Game 2...) to get average curve
    // Need to sort all league games chronologically
    const lgSorted = [...leagueGames].sort((a,b) => (a.year - b.year) || (a.week - b.week));
    
    // Build running totals
    let myTotal = 0;
    const myPoints = mySorted.map(g => {
      myTotal += g.score;
      return myTotal;
    });

    // League Avg Running Total
    // We assume roughly 12 games per week. We take the average score of all games at index i
    // This is an approximation since schedules vary, but good for visualization
    const leaguePoints = [];
    let lgTotal = 0;
    const gameCount = mySorted.length;
    
    // Simple average per game across history approx
    const totalLgScore = lgSorted.reduce((a,b)=>a+b.score,0);
    const avgGameScore = totalLgScore / lgSorted.length;
    
    for(let i=0; i<gameCount; i++) {
      lgTotal += avgGameScore;
      leaguePoints.push(lgTotal);
    }

    const ctx = document.getElementById('cumulativeChart').getContext('2d');
    if (charts.cumul) charts.cumul.destroy();

    charts.cumul = new Chart(ctx, {
      type: 'line',
      data: {
        labels: myPoints.map((_, i) => `G${i+1}`),
        datasets: [
          {
            label: 'My Career Points',
            data: myPoints,
            borderColor: '#22c55e',
            borderWidth: 2,
            pointRadius: 0
          },
          {
            label: 'League Avg Pace',
            data: leaguePoints,
            borderColor: '#6b7280',
            borderWidth: 2,
            borderDash: [5, 5],
            pointRadius: 0
          }
        ]
      },
      options: {
        maintainAspectRatio: false,
        plugins: { legend: { labels: { color: '#9ca3af' } } },
        scales: {
          x: { display: false },
          y: { grid: { color: 'rgba(255,255,255,0.05)' } }
        }
      }
    });
  }

  // 6. Heat Check (Custom Grid)
  function renderHeatmap(games) {
    const grid = document.getElementById('heatmapGrid');
    grid.innerHTML = '';

    // Header Row (Weeks)
    const header = document.createElement('div');
    header.className = 'hm-header';
    header.textContent = ''; // corner
    grid.appendChild(header);
    for(let w=1; w<=17; w++) {
      const h = document.createElement('div');
      h.className = 'hm-header';
      h.textContent = w;
      grid.appendChild(h);
    }

    // Rows (Years)
    const years = [...new Set(games.map(g => g.year))].sort((a,b)=>b-a);
    
    years.forEach(y => {
      // Year Label
      const yLabel = document.createElement('div');
      yLabel.className = 'hm-year';
      yLabel.textContent = y;
      grid.appendChild(yLabel);

      // Weeks 1-17
      for(let w=1; w<=17; w++) {
        const game = games.find(g => g.year === y && g.week === w);
        const cell = document.createElement('div');
        cell.className = 'hm-cell';
        
        if (game) {
          if (game.result === 'W') cell.classList.add('hm-win');
          else if (game.result === 'L') cell.classList.add('hm-loss');
          else cell.classList.add('hm-tie');
          
          cell.setAttribute('data-tooltip', `Wk ${w}: ${game.result} vs ${game.opponent} (${game.score.toFixed(1)})`);
        }
        grid.appendChild(cell);
      }
    });
  }

  // --- Utils ---
  window.switchTab = function(tabName) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.table-section').forEach(s => s.classList.remove('active'));
    
    if(tabName === 'seasons') {
      document.querySelector('button[onclick="switchTab(\'seasons\')"]').classList.add('active');
      document.getElementById('tabSeasons').classList.add('active');
    } else {
      document.querySelector('button[onclick="switchTab(\'games\')"]').classList.add('active');
      document.getElementById('tabGames').classList.add('active');
    }
  };

</script>
</body>
</html>
