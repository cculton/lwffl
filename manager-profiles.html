<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Manager Profile ‚Äì LWFFL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-main: #020617;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-dim: rgba(56, 189, 248, 0.15);
      --border-subtle: #1f2937;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --positive: #22c55e;
      --negative: #ef4444;
      --warning: #f59e0b;
      --money: #22c55e;
      --gold: #fbbf24;
      --gold-bg: rgba(251, 191, 36, 0.1);
      --silver: #cbd5e1;
      --silver-bg: rgba(203, 213, 225, 0.1);
      --bronze: #d97706;
      --bronze-bg: rgba(217, 119, 6, 0.1);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0%, #020617 35%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 16px;
    }

    .shell { max-width: 1200px; margin: 0 auto; }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .manager-select-wrapper { position: relative; min-width: 250px; }

    select {
      width: 100%;
      padding: 10px 14px;
      background-color: #0b1120;
      border: 1px solid rgba(75, 85, 99, 0.9);
      border-radius: 10px;
      color: #f9fafb;
      font-size: 0.95rem;
      font-weight: 500;
      appearance: none;
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 16px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%), var(--card-bg);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
      margin-bottom: 24px;
      backdrop-filter: blur(14px);
    }

    .hero-card { display: flex; align-items: center; justify-content: space-between; gap: 32px; padding: 32px 40px; }
    .hero-identity { display: flex; align-items: center; gap: 24px; flex: 1.2; min-width: 260px; }
    .avatar { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; font-size: 2.2rem; font-weight: 800; color: #fff; background: linear-gradient(135deg, rgba(56,189,248,0.2), rgba(2,6,23,0.8)); }
    .hero-name { font-size: 2rem; font-weight: 800; text-transform: uppercase; color: #f9fafb; line-height: 1.1; }
    .hero-tenure { color: var(--text-muted); font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.15em; }

    .trophy-case { display: flex; flex-wrap: wrap; gap: 8px; flex: 1.5; justify-content: center; border-left: 1px solid var(--border-subtle); border-right: 1px solid var(--border-subtle); padding: 0 32px; }
    .trophy-badge { display: inline-flex; align-items: center; gap: 6px; padding: 5px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; border: 1px solid transparent; }
    .trophy-badge.gold { background: var(--gold-bg); color: var(--gold); border-color: rgba(251, 191, 36, 0.3); }
    .trophy-badge.scoring { background: rgba(59, 130, 246, 0.16); color: #93c5fd; border-color: rgba(59, 130, 246, 0.35); }

    .rating-container { display: flex; align-items: center; gap: 32px; flex: 1; justify-content: flex-end; min-width: 320px; }
    .sub-ratings { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 24px; }
    .sub-stat { display: flex; justify-content: space-between; gap: 12px; font-size: 0.72rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }
    .sub-stat span:last-child { color: var(--accent); font-family: monospace; font-size: 0.9rem; }
    .ovr-ring { width: 75px; height: 75px; border-radius: 50%; border: 3px solid var(--accent); display: flex; align-items: center; justify-content: center; background: rgba(2, 6, 23, 0.8); }
    .ovr-val { font-size: 2.2rem; font-weight: 900; }
    .ovr-label { font-size: 0.75rem; font-weight: 700; color: var(--accent); margin-top: 8px; text-align: center; display: block; }

    .stats-strip { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .stat-box { background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 16px; text-align: center; }
    .stat-label { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 6px; display: block; }
    .stat-val { font-size: 1.4rem; font-weight: 700; color: #f9fafb; }

    .analytics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
    .chart-card { min-height: 350px; display: flex; flex-direction: column; }
    .chart-header { margin-bottom: 12px; border-bottom: 1px solid var(--border-subtle); padding-bottom: 12px; }
    .chart-title-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
    .chart-header h3 { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; margin: 0; }
    .chart-subtitle { font-size: 0.7rem; color: var(--text-soft); font-weight: 500; }
    .chart-container { position: relative; flex: 1; width: 100%; min-height: 220px; }

    .rivalry-col { display: flex; flex-direction: column; gap: 20px; }
    .rival-card { background: rgba(15, 23, 42, 0.8); border: 1px solid var(--border-subtle); border-left: 4px solid var(--border-subtle); padding: 16px 20px; border-radius: 4px 12px 12px 4px; display: flex; justify-content: space-between; align-items: center; }
    .rival-card.pigeon { border-left-color: var(--positive); }
    .rival-card.nemesis { border-left-color: var(--negative); }
    .rival-stat { font-family: monospace; font-weight: 700; font-size: 1.1rem; }
    .pigeon .rival-stat { color: var(--positive); }
    .nemesis .rival-stat { color: var(--negative); }

    .hl-ticker { display: flex; flex-direction: column; gap: 12px; padding: 10px 0; }
    .hl-row { display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-subtle); padding: 10px 14px; border-radius: 8px; }
    .hl-score { font-size: 1.2rem; font-weight: 800; color: #fff; }
    .hl-meta { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; }
    .hl-high .hl-score { color: var(--positive); }
    .hl-low .hl-score { color: var(--negative); }

    .fate-flow { display: flex; flex-direction: column; gap: 8px; padding: 10px 0; }
    .fate-step { display: flex; align-items: center; background: rgba(255,255,255,0.03); border-radius: 6px; height: 36px; position: relative; overflow: hidden; }
    .fate-bar { height: 100%; background: rgba(56, 189, 248, 0.2); border-right: 2px solid var(--accent); transition: width 0.5s ease-out; }
    .fate-label { position: absolute; left: 12px; font-size: 0.75rem; font-weight: 700; z-index: 2; text-transform: uppercase; }
    .fate-val { position: absolute; right: 12px; font-size: 0.85rem; font-family: monospace; font-weight: 700; z-index: 2; }

    .table-wrap { border: 1px solid var(--border-subtle); border-radius: 12px; overflow-x: auto; margin-top: 24px; }
    table { width: 100%; border-collapse: collapse; min-width: 700px; }
    th { background: rgba(15, 23, 42, 0.95); text-align: left; padding: 12px 16px; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border-subtle); }
    td { padding: 12px 16px; border-bottom: 1px solid rgba(31, 41, 55, 0.5); color: #fff; }
  </style>
</head>

<body>
  <div class="shell">
    <div class="top-bar">
      <div class="page-title">Manager Profile</div>
      <div class="manager-select-wrapper"><select id="managerSelect"></select></div>
    </div>

    <div class="card hero-card">
      <div class="hero-identity">
        <div class="avatar" id="heroAvatar"></div>
        <div class="hero-text">
          <div class="hero-name" id="heroName">Manager Name</div>
          <div class="hero-tenure" id="heroTenure">EST. 20XX</div>
        </div>
      </div>
      <div class="trophy-case" id="trophyCase"></div>
      <div class="rating-container">
        <div class="sub-ratings">
          <div class="sub-stat"><span>Peak</span> <span id="ratingPeak">-</span></div>
          <div class="sub-stat"><span>Floor</span> <span id="ratingFloor">-</span></div>
          <div class="sub-stat"><span>Œî 10</span> <span id="ratingDelta">-</span></div>
          <div class="sub-stat"><span>Rank</span> <span id="ratingRank">-</span></div>
        </div>
        <div class="ovr-badge">
          <div class="ovr-ring"><span class="ovr-val" id="heroElo">--</span></div>
          <span class="ovr-label">ELO</span>
        </div>
      </div>
    </div>

    <div class="stats-strip">
      <div class="stat-box"><span class="stat-label">Career Record</span><span class="stat-val" id="statRecord">-</span></div>
      <div class="stat-box"><span class="stat-label">Avg Finish</span><span class="stat-val" id="statFinish">-</span></div>
      <div class="stat-box"><span class="stat-label">Avg Score</span><span class="stat-val" id="statScore">-</span></div>
      <div class="stat-box"><span class="stat-label">Earnings</span><span class="stat-val" id="statCash" style="color:var(--money)">-</span></div>
    </div>

    <div class="analytics-grid">
      <div class="rivalry-col">
        <div class="card" style="padding:16px;">
          <div class="chart-header">
            <div class="chart-title-row"><div class="chart-icon">‚Üï</div><h3>Highs & Lows</h3></div>
            <span class="chart-subtitle">Personal best and worst single-game outputs.</span>
          </div>
          <div class="hl-ticker" id="hlTicker"></div>
        </div>
        <div class="rival-card pigeon"><div class="rival-meta"><span class="rival-type">Pigeon</span><span class="rival-name" id="pigeonName">-</span></div><span class="rival-stat" id="pigeonStat">-</span></div>
        <div class="rival-card nemesis"><div class="rival-meta"><span class="rival-type">Nemesis</span><span class="rival-name" id="nemesisName">-</span></div><span class="rival-stat" id="nemesisStat">-</span></div>
      </div>

      <div class="card chart-card">
        <div class="chart-header">
          <div class="chart-title-row"><div class="chart-icon">‚ö°</div><h3>ELO Progression</h3></div>
          <span class="chart-subtitle">End-of-season power rating vs. the league average (dashed).</span>
        </div>
        <div class="chart-container"><canvas id="eloProgChart"></canvas></div>
      </div>

      <div class="card chart-card">
        <div class="chart-header">
          <div class="chart-title-row"><div class="chart-icon">‚ú¶</div><h3>Luck Index</h3></div>
          <span class="chart-subtitle">Points For vs Points Against rank quadrants.</span>
        </div>
        <div class="chart-container"><canvas id="luckChart"></canvas></div>
      </div>

      <div class="card chart-card">
        <div class="chart-header">
          <div class="chart-icon">üíì</div><h3>Heart Attack Ratio</h3></div>
          <span class="chart-subtitle">Win/Loss results for games decided by fewer than 5 points.</span>
        </div>
        <div class="chart-container"><canvas id="heartChart"></canvas></div>
      </div>

      <div class="card chart-card">
        <div class="chart-header">
          <div class="chart-icon">üìä</div><h3>Scoring Spread</h3></div>
          <span class="chart-subtitle">Annual volatility showing the gap between floor and ceiling.</span>
        </div>
        <div class="chart-container"><canvas id="spreadChart"></canvas></div>
      </div>

      <div class="card chart-card">
        <div class="chart-header">
          <div class="chart-title-row"><div class="chart-icon">üèÅ</div><h3>Post-Season Fate</h3></div>
          <span class="chart-subtitle">Manager's path from entry to championship conversion.</span>
        </div>
        <div id="fateFlow" class="fate-flow"></div>
      </div>
    </div>

    <div class="card"><div class="table-wrap"><table id="seasonTable"><thead><tr><th>Year</th><th>Record</th><th>Finish</th><th>PF</th><th>PA</th><th>Seed</th><th>Earnings</th></tr></thead><tbody></tbody></table></div></div>
  </div>

  <script>
    let rawScores = [], rawStandings = [], rawSeeds = [];
    const leagueRatings = {}, seasonalEloHistory = {}, leagueSeasonalAverage = {}, charts = {};

    const buildIndexes = () => {
      window.idx = {
        managers: [...new Set(rawStandings.map(s => s.manager))].sort(),
        standingsByManager: new Map(),
        gamesByManager: new Map(),
        seedsByManagerYear: new Map(),
        scoringTitles: new Map()
      };
      rawStandings.forEach(s => {
        if(!idx.standingsByManager.has(s.manager)) idx.standingsByManager.set(s.manager, []);
        idx.standingsByManager.get(s.manager).push(s);
      });
      rawSeeds.forEach(s => idx.seedsByManagerYear.set(`${s.manager}::${s.year}`, s.seed));
      
      const years = [...new Set(rawStandings.map(s => s.year))];
      years.forEach(y => {
        const yearStandings = rawStandings.filter(s => s.year === y).sort((a,b) => b.points_for - a.points_for);
        if(yearStandings.length) {
          if(!idx.scoringTitles.has(yearStandings[0].manager)) idx.scoringTitles.set(yearStandings[0].manager, new Set());
          idx.scoringTitles.get(yearStandings[0].manager).add(y);
        }
      });
    };

    const calculateRatings = () => {
      const BASE = 1500;
      const ratings = {};
      idx.managers.forEach(m => { 
        ratings[m] = BASE; 
        seasonalEloHistory[m] = [];
      });

      const processedGames = rawScores.sort((a,b) => a.year !== b.year ? a.year - b.year : a.week - b.week);
      let currentYear = processedGames[0]?.year;

      processedGames.forEach(g => {
        if(g.year !== currentYear) {
          const yearlyR = [];
          idx.managers.forEach(m => {
            seasonalEloHistory[m].push({ year: currentYear, elo: Math.round(ratings[m]) });
            yearlyR.push(ratings[m]);
          });
          leagueSeasonalAverage[currentYear] = yearlyR.reduce((a,b)=>a+b,0) / yearlyR.length;
          currentYear = g.year;
        }

        const m1 = g.manager1, m2 = g.manager2;
        const r1 = ratings[m1], r2 = ratings[m2];
        const e1 = 1 / (1 + Math.pow(10, (r2 - r1) / 400));
        const s1 = g.score1 > g.score2 ? 1 : (g.score1 < g.score2 ? 0 : 0.5);
        const k = 32;
        const delta = k * (s1 - e1);
        ratings[m1] += delta; ratings[m2] -= delta;

        [m1, m2].forEach(m => {
          if(!idx.gamesByManager.has(m)) idx.gamesByManager.set(m, []);
          idx.gamesByManager.get(m).push({
            year: g.year, week: g.week, 
            score: m === m1 ? g.score1 : g.score2,
            oppScore: m === m1 ? g.score2 : g.score1,
            opponent: m === m1 ? m2 : m1,
            result: (m === m1 ? g.score1 > g.score2 : g.score2 > g.score1) ? 'W' : 'L'
          });
        });
      });

      // Ranks (3+ seasons only)
      const eligible = idx.managers.filter(m => (idx.standingsByManager.get(m) || []).length >= 3);
      const ranked = [...eligible].sort((a,b) => ratings[b] - ratings[a]);
      
      idx.managers.forEach(m => {
        leagueRatings[m] = {
          elo: Math.round(ratings[m]),
          rank: eligible.includes(m) ? ranked.indexOf(m) + 1 : '‚Äî'
        };
      });
    };

    const loadManager = (name) => {
      const seasons = idx.standingsByManager.get(name) || [];
      const games = idx.gamesByManager.get(name) || [];
      const r = leagueRatings[name];

      document.getElementById('heroName').textContent = name;
      document.getElementById('heroAvatar').textContent = name.split(' ').map(n=>n[0]).join('');
      document.getElementById('heroElo').textContent = r.elo;
      document.getElementById('ratingRank').textContent = r.rank;
      document.getElementById('heroTenure').textContent = `EST. ${Math.min(...seasons.map(s=>s.year))}`;

      // Stats
      const w = games.filter(g=>g.result==='W').length, l = games.filter(g=>g.result==='L').length;
      document.getElementById('statRecord').textContent = `${w}-${l}`;
      document.getElementById('statScore').textContent = (games.reduce((a,b)=>a+b.score,0)/games.length).toFixed(1);
      
      // Hardware
      const trophyEl = document.getElementById('trophyCase');
      trophyEl.innerHTML = '';
      const champs = seasons.filter(s=>s.final_standing===1).length;
      if(champs) trophyEl.innerHTML += `<span class="trophy-badge gold">üèÜ Champion x${champs}</span>`;
      
      renderTicker(games);
      renderRivals(games);
      renderCharts(name, seasons, games);
    };

    const renderTicker = (games) => {
      const scores = games.map(g=>g.score).sort((a,b)=>b-a);
      document.getElementById('hlTicker').innerHTML = `
        <div class="hl-row hl-high"><div>‚ñ≤ High</div><div class="hl-score">${scores[0]}</div></div>
        <div class="hl-row hl-low"><div>‚ñº Low</div><div class="hl-score">${scores[scores.length-1]}</div></div>
      `;
    };

    const renderRivals = (games) => {
      const opponents = {};
      games.forEach(g => {
        if(!opponents[g.opponent]) opponents[g.opponent] = {w:0, g:0};
        opponents[g.opponent].g++;
        if(g.result==='W') opponents[g.opponent].w++;
      });
      const sorted = Object.keys(opponents).sort((a,b) => (opponents[b].w/opponents[b].g) - (opponents[a].w/opponents[a].g));
      document.getElementById('pigeonName').textContent = sorted[0];
      document.getElementById('nemesisName').textContent = sorted[sorted.length-1];
    };

    const renderCharts = (name, seasons, games) => {
      if(charts.elo) charts.elo.destroy();
      const eloData = seasonalEloHistory[name];
      charts.elo = new Chart(document.getElementById('eloProgChart'), {
        type: 'line',
        data: {
          labels: eloData.map(d=>d.year),
          datasets: [
            { data: eloData.map(d=>d.elo), borderColor: '#38bdf8', tension: 0.1 },
            { data: eloData.map(d=>leagueSeasonalAverage[d.year]), borderColor: '#666', borderDash: [5,5], pointRadius: 0 }
          ]
        },
        options: { 
          maintainAspectRatio: false, 
          plugins: { legend: { display: false } },
          scales: { y: { min: 1300, max: 1750 } }
        }
      });

      if(charts.heart) charts.heart.destroy();
      const close = games.filter(g => Math.abs(g.score - g.oppScore) < 5);
      charts.heart = new Chart(document.getElementById('heartChart'), {
        type: 'doughnut',
        data: {
          labels: ['W', 'L'],
          datasets: [{ data: [close.filter(g=>g.result==='W').length, close.filter(g=>g.result==='L').length], backgroundColor: ['#22c55e', '#ef4444'] }]
        },
        options: { maintainAspectRatio: false }
      });
    };

    const init = async () => {
      const fetchJSON = async (url) => (await fetch(url)).json();
      [rawScores, rawStandings, rawSeeds] = await Promise.all([
        fetchJSON('league-scores.json'), fetchJSON('final-standings.json'), fetchJSON('playoff-seeds.json')
      ]);
      buildIndexes();
      calculateRatings();
      
      const sel = document.getElementById('managerSelect');
      idx.managers.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m; opt.textContent = m;
        sel.appendChild(opt);
      });
      sel.addEventListener('change', e => loadManager(e.target.value));
      loadManager(idx.managers[0]);
    };

    init();
  </script>
</body>
</html>
